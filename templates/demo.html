<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>PI Builder - Template Demo</title>
  <link rel="stylesheet" href="_base/styles.css">
  <style>
    /* Demo page specific styles */
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }

    body {
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
      background: linear-gradient(135deg, #0a0a0f 0%, #1a1a2e 50%, #0a0a0f 100%);
      color: #fff;
      min-height: 100vh;
    }

    #template-selector {
      position: fixed;
      top: 0;
      left: 0;
      right: 0;
      z-index: 1000;
      background: rgba(10, 10, 15, 0.95);
      backdrop-filter: blur(10px);
      border-bottom: 1px solid rgba(255, 255, 255, 0.1);
      padding: 12px 20px;
      display: flex;
      gap: 12px;
      align-items: center;
    }

    #template-selector h1 {
      font-size: 16px;
      font-weight: 600;
      margin-right: 20px;
      color: #3b82f6;
    }

    .template-btn {
      padding: 8px 16px;
      background: rgba(255, 255, 255, 0.05);
      border: 1px solid rgba(255, 255, 255, 0.1);
      border-radius: 8px;
      color: #fff;
      font-size: 13px;
      cursor: pointer;
      transition: all 0.2s;
      display: flex;
      align-items: center;
      gap: 6px;
    }

    .template-btn:hover {
      background: rgba(255, 255, 255, 0.1);
      border-color: rgba(255, 255, 255, 0.2);
    }

    .template-btn.active {
      background: var(--pi-primary, #3b82f6);
      border-color: var(--pi-primary, #3b82f6);
    }

    .template-btn .icon {
      font-size: 16px;
    }

    #loading-indicator {
      position: fixed;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%);
      background: rgba(10, 10, 15, 0.9);
      padding: 20px 40px;
      border-radius: 12px;
      border: 1px solid rgba(255, 255, 255, 0.1);
      display: none;
      z-index: 2000;
    }

    #loading-indicator.active {
      display: block;
    }

    #pi-app {
      padding-top: 60px;
      min-height: 100vh;
    }

    .mode-toggle {
      margin-left: auto;
      display: flex;
      align-items: center;
      gap: 8px;
      font-size: 12px;
      color: rgba(255, 255, 255, 0.5);
    }

    .mode-toggle select {
      background: rgba(255, 255, 255, 0.05);
      border: 1px solid rgba(255, 255, 255, 0.1);
      border-radius: 4px;
      color: #fff;
      padding: 4px 8px;
      font-size: 11px;
    }
  </style>
</head>
<body>
  <div id="template-selector">
    <h1>PI Builder</h1>
    <button class="template-btn" data-template="restaurant">
      <span class="icon">&#127860;</span>
      <span>Restaurant</span>
    </button>
    <button class="template-btn" data-template="tech">
      <span class="icon">&#128187;</span>
      <span>Tech/AI</span>
    </button>
    <button class="template-btn" data-template="retail" disabled title="Coming soon">
      <span class="icon">&#127978;</span>
      <span>Retail</span>
    </button>
    <button class="template-btn" data-template="realestate" disabled title="Coming soon">
      <span class="icon">&#127968;</span>
      <span>Real Estate</span>
    </button>
    <button class="template-btn" data-template="healthcare" disabled title="Coming soon">
      <span class="icon">&#127973;</span>
      <span>Healthcare</span>
    </button>
    <button class="template-btn" data-template="logistics" disabled title="Coming soon">
      <span class="icon">&#128666;</span>
      <span>Logistics</span>
    </button>
    <button class="template-btn" data-template="events" disabled title="Coming soon">
      <span class="icon">&#127917;</span>
      <span>Events</span>
    </button>
    <button class="template-btn" data-template="education" disabled title="Coming soon">
      <span class="icon">&#127891;</span>
      <span>Education</span>
    </button>

    <div class="mode-toggle">
      <span>Deploy Mode:</span>
      <select id="deploy-mode">
        <option value="local">Local Bundle</option>
        <option value="cdn">CDN</option>
      </select>
    </div>
  </div>

  <div id="loading-indicator">Loading template...</div>

  <div id="pi-app"></div>

  <!-- Local bundle (configurable) -->
  <script src="../../public/lib/three.min.js"></script>

  <!-- Base components -->
  <script src="_base/globe.js"></script>
  <script src="_base/config-loader.js"></script>
  <script src="_base/panels.js"></script>
  <script src="_base/pi-template.js"></script>

  <!-- Templates -->
  <script src="restaurant/template.js"></script>
  <script src="tech/template.js"></script>

  <script>
    let currentTemplate = null;
    let loadedStyles = [];

    // Template button handlers
    document.querySelectorAll('.template-btn:not([disabled])').forEach(btn => {
      btn.addEventListener('click', async () => {
        const template = btn.dataset.template;
        if (template === currentTemplate) return;

        // Update active state
        document.querySelectorAll('.template-btn').forEach(b => b.classList.remove('active'));
        btn.classList.add('active');

        await loadTemplate(template);
      });
    });

    async function loadTemplate(templateId) {
      const loading = document.getElementById('loading-indicator');
      loading.classList.add('active');

      try {
        // Clear previous
        document.getElementById('pi-app').innerHTML = '';

        // Remove old template styles
        loadedStyles.forEach(link => link.remove());
        loadedStyles = [];

        // Reset CSS variables to defaults
        document.documentElement.style.removeProperty('--pi-primary');
        document.documentElement.style.removeProperty('--pi-secondary');

        // Apply template-specific formatters
        if (templateId === 'restaurant' && typeof PIRestaurant !== 'undefined') {
          PIRestaurant.apply();
        } else if (templateId === 'tech' && typeof PITech !== 'undefined') {
          PITech.apply();
        }

        // Load template styles
        const link = document.createElement('link');
        link.rel = 'stylesheet';
        link.href = `${templateId}/styles.css`;
        document.head.appendChild(link);
        loadedStyles.push(link);

        // Wait for styles to load
        await new Promise(resolve => {
          link.onload = resolve;
          link.onerror = resolve;
        });

        // Initialize with sample config
        const success = await PITemplate.init({
          containerId: 'pi-app',
          configPath: `./${templateId}/config.example.json`,
          onReady: (config) => {
            console.log(`[Demo] ${templateId} template loaded:`, config.business.name);
          },
          onSelect: (id, data) => {
            console.log(`[Demo] Selected:`, id, data);
          }
        });

        if (success) {
          currentTemplate = templateId;
        } else {
          console.error(`[Demo] Failed to load ${templateId} template`);
        }

      } catch (error) {
        console.error('[Demo] Error loading template:', error);
      } finally {
        loading.classList.remove('active');
      }
    }

    // Auto-load restaurant template on page load
    window.addEventListener('DOMContentLoaded', () => {
      console.log('[Demo] PI Builder Demo loaded');
      console.log('[Demo] THREE.js available:', typeof THREE !== 'undefined');
      console.log('[Demo] PITemplate available:', typeof PITemplate !== 'undefined');
      console.log('[Demo] PIRestaurant available:', typeof PIRestaurant !== 'undefined');
      console.log('[Demo] PITech available:', typeof PITech !== 'undefined');

      // Auto-select restaurant template
      const restaurantBtn = document.querySelector('[data-template="restaurant"]');
      if (restaurantBtn) {
        restaurantBtn.click();
      }
    });

    // Deploy mode toggle handler
    document.getElementById('deploy-mode').addEventListener('change', (e) => {
      console.log('[Demo] Deploy mode changed to:', e.target.value);
      // This affects the generated export, not the current demo
    });
  </script>
</body>
</html>
